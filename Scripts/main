/**<--------------> CODIGO PRINCIPAL <------------->**/

//REVISADO
function planSchedule() {
  //Conseguimos las cosas basicas para saber cuando operamos
  const now = getNow_(); // Momento (con offset)
  const horizon = new Date(now.getTime() + HORIZON_DAYS * 24 * 60 * 60 * 1000); // Final del periodo de planning
  const eventTotal = [...getPendingTasks_(now),...buildExamPriorityArray_()]; // Los eventos que vamos a colocar
  
  if (eventTotal.length > 0) {
    // Ordenamos las tareas en funcion del orden de prioridades de dentro de la funci√≥n
    const eventosOrdenados = sortEventsByUrgency_(eventTotal);
    const espaciosLibre = buildFreeSlots_(now,horizon);
    if (!espaciosLibre){
      Logger.log("No hay espacios libres"); 
      return} 
    clearAllEvents();
    scheduleTasksIntoFreeSlots_(espaciosLibre,eventosOrdenados);
  }
}

//REVISADO
function clearAllEvents(){
    const now = getNow_(); // Momento (con offset)
    const horizon = new Date(now.getTime() + HORIZON_DAYS * 24 * 60 * 60 * 1000);
    clearAutomaticEvents_(fetchCalendar_(TASK_CALENDAR_NAME), now, horizon);
    clearAutomaticEvents_(fetchCalendar_(STUDY_CALENDAR_NAME), now, horizon);
    clearAutomaticEvents_(fetchCalendar_(PROJECT_CALENDAR_NAME), now, horizon);
}
